package odps.utils;

import com.aliyun.odps.udf.UDF;
import org.apache.commons.lang.StringUtils;

import java.util.ArrayList;

public class AreaCoorsCenter extends UDF {

    public static void main(String[] args) {
        String s
                = "[[[108.29794251818582,30.547737824644219],[108.294265427464097,30.544146279433292],[108.290501690656981,30.541379039497162],[108.287015657982437,30.539157563566597],[108.285215262822291,30.537288364395572],[108.283568107865619,30.538466564244459],[108.280751352343358,30.539398653360752],[108.279767823663292,30.540074710105404],[108.278637257998184,30.541348696009013],[108.278524202953207,30.542094623618844],[108.278524211432199,30.543664709704522],[108.278321123949908,30.544601563563493],[108.277438727749171,30.545221791472553],[108.277325678070071,30.545387700567943],[108.276715425260633,30.545536175184022],[108.275494954292952,30.545387132156318],[108.273764396260802,30.544988728605624],[108.272477059533941,30.54448974730926],[108.271963943851091,30.544036357136584],[108.271335817559461,30.543618904077711],[108.270882736132606,30.543561595837193],[108.270453670257567,30.54400233702372],[108.270408665157873,30.544555335474303],[108.270675724599641,30.546872633324391],[108.270781748162165,30.547413733083744],[108.270737737910665,30.547748719359543],[108.270950774896662,30.548226885843711],[108.273070230412969,30.549343446433095],[108.273025231681316,30.55006044968367],[108.272409082149451,30.550478024349211],[108.271408878465749,30.551730397579913],[108.270584746362985,30.5525138948924],[108.268623537929273,30.553770754146491],[108.268267514359323,30.554064572975847],[108.267957506810447,30.55452741913183],[108.267697504929629,30.555447333367091],[108.267681507980953,30.556018363686789],[108.267810513148305,30.556645478662627],[108.268070525621127,30.557018644826599],[108.268579555333659,30.557052940222714],[108.269053592762489,30.556980207960404],[108.270284729109932,30.556393934976949],[108.270832809811822,30.556309294244436],[108.271086857051102,30.556310465328202],[108.272263095814822,30.557006321894214],[108.272681191877453,30.55749265868484],[108.272918257340606,30.558057861792928],[108.273008284036436,30.55849895960775],[108.272907270543868,30.560374007218513],[108.272492172107789,30.560897743544096],[108.27256118283637,30.560881795421228],[108.272155097357157,30.560994508089134],[108.271906042483351,30.561007335572182],[108.270849846573256,30.5606175843362],[108.270666807996591,30.560598463157117],[108.270212747025099,30.560658175513744],[108.269860703229767,30.560837967942479],[108.268861603141474,30.56157740468926],[108.267371550074174,30.56302066671137],[108.266986550055293,30.563241474415634],[108.266727548291641,30.563275341239592],[108.266483557607955,30.563207211367271],[108.266308560073767,30.563099121380723],[108.265340598233777,30.561886570733993],[108.264964635399039,30.56168037974388],[108.264563665999219,30.561674204741283],[108.264235706710707,30.562030091871808],[108.263965746382212,30.562539019109348],[108.263777780294902,30.562793959385832],[108.263767784024765,30.562880956546039],[108.263543817279455,30.563071882569826],[108.263174874073314,30.563277755126993],[108.262856931337708,30.563265632427829],[108.262685964647972,30.563189568701226],[108.26245500343299,30.562309421766937],[108.262477994084804,30.562117411158191],[108.262285039223869,30.561933334823298],[108.261875121777422,30.561866185682653],[108.261450223451988,30.561995057953506],[108.260717422617645,30.56241486983561],[108.260323546979876,30.563679841290579],[108.259925664454201,30.564458796013518],[108.259371857028242,30.565290713948251],[108.260140615518054,30.565872949902467],[108.260958380022913,30.56608819998263],[108.261705196133491,30.566182441158254],[108.262268071406254,30.566491652059604],[108.262491022649584,30.566840757854635],[108.262188096799605,30.56776771498139],[108.261472268086195,30.569258599637575],[108.261304307322646,30.569400553857484],[108.26128431986433,30.569471553965538],[108.260582505065898,30.570006382769005],[108.260352574898889,30.569696294305942],[108.259621804028484,30.56974010414152],[108.259273919912275,30.569717023862651],[108.259167953486582,30.569518981326073],[108.259038993985243,30.569419940577177],[108.259007011899442,30.56925292419692],[108.259347893351674,30.569155996235963],[108.259583811877619,30.569009042180063],[108.259083979056555,30.568612898193258],[108.258757093517275,30.568446807291775],[108.258654131664258,30.568134766580773],[108.258484190057629,30.567958713759847],[108.258458203968132,30.567867706624043],[108.258492188115781,30.567786703284494],[108.258772078913822,30.567510743385565],[108.258719103652425,30.56714870387059],[108.258760080058352,30.566804687869489],[108.258609136712053,30.566615643258498],[108.258394217857145,30.566612595408479],[108.258222284810017,30.566386546294694],[108.257839433581864,30.566506480589435],[108.257652511684924,30.566370435246895],[108.257351640621266,30.566277381862363],[108.257321647814237,30.566211374429603],[108.257192705053598,30.566200354509629],[108.257061767394944,30.566250336820968],[108.256978804549405,30.566411334927309],[108.256602976685443,30.56685931552515],[108.256254139330011,30.567120286866633],[108.256214160162941,30.567359299246128],[108.256264144636589,30.567791338708279],[108.255887326949406,30.567776293501019],[108.255606469626059,30.5678662771417],[108.255623456377805,30.567563249291631],[108.255715409517805,30.567207237322215],[108.255662431625183,30.567136228429931],[108.255562483266132,30.567108212231492],[108.255417554578457,30.567120198292816],[108.255283633235123,30.567538221453919],[108.254340141787054,30.567487153773659],[108.253727493761076,30.56756414048083],[108.253656535095175,30.567500128300292],[108.253632558512749,30.567327116493995],[108.253400696093422,30.567244110896421],[108.25329175419013,30.567276105057097],[108.253191816838338,30.567398121713339],[108.252984947372966,30.567528125510101],[108.252739110416812,30.567807146329951],[108.252109518771348,30.568280203995133],[108.25202457807336,30.568486224378397],[108.252244439796968,30.568861243976357],[108.252630190509151,30.5691232556632],[108.253371729265311,30.56936126359772],[108.254004350384463,30.569386285294598],[108.254120291174758,30.570176351097501],[108.254425114147466,30.570794408093672],[108.254453105830535,30.571184439964519],[108.25411330742331,30.572271511090733],[108.255029802749959,30.572599590610945],[108.25600529938788,30.573081722720929],[108.256701968633408,30.573236821706363],[108.258113373140958,30.573419061081811],[108.259938728549656,30.573334468569985],[108.260137662315259,30.573209508563959],[108.260931436365951,30.573310742159098],[108.26121536106443,30.573511851641491],[108.261420315920731,30.573806936196146],[108.261570276800853,30.574267016908639],[108.261636255630251,30.574124033633677],[108.261722236722122,30.574116055722904],[108.262020172286768,30.574444184507342],[108.262039177436563,30.575345260324458],[108.262116163880634,30.575557311646936],[108.262419099320169,30.575651420967191],[108.262773028727807,30.575898566794866],[108.263024988905116,30.576801733654037],[108.262951008694131,30.577005723620754],[108.263469918553369,30.577502967540916],[108.263633896626743,30.577825055550637],[108.263924853741102,30.577979189928907],[108.264241819431973,30.577965325484858],[108.2646597689575,30.577700482569227],[108.264965739322463,30.577650608954759],[108.265118725264927,30.57768668596038],[108.265289711914662,30.577930778263099],[108.265555695591132,30.578128915921962],[108.265801674924901,30.578022024655045],[108.266386657413307,30.578013317759094],[108.266493650161323,30.578531409271694],[108.266755653573981,30.578688561793289],[108.26713765256649,30.578669760739018],[108.267447652631645,30.57840289686364],[108.26768465398689,30.578373026546235],[108.268355679845911,30.578346399651362],[108.269090734922713,30.578614854361799],[108.270442913885915,30.580750883535046],[108.271047006359368,30.580632276808995],[108.270918983819428,30.580440164338818],[108.270896979261394,30.580256142102598],[108.270987999565421,30.580129192467385],[108.271086011985915,30.580117250288918],[108.271532096759174,30.580222567081826],[108.271801153912051,30.580566781923554],[108.27207921087691,30.58064298583777],[108.273074445081903,30.580480692277234],[108.273998692806714,30.580167364988647],[108.274639893842092,30.580229879992309],[108.274818955666703,30.580184010066432],[108.275010016944478,30.580277182192724],[108.275292114362202,30.580213398641124],[108.276006379663698,30.580353010189192],[108.276321493376017,30.580283271209158],[108.276574594972686,30.580385498014177],[108.276710649486432,30.580224601416983],[108.277854141744143,30.580148609248742],[108.278242326493285,30.580022954024745],[108.278626503734287,30.580040313361799],[108.279146759929432,30.579827786739049],[108.280328383220777,30.579674916071724],[108.281171867636118,30.579696771858753],[108.281355972070344,30.579518937491585],[108.281598121116815,30.579585192539838],[108.281648154033363,30.579501241347113],[108.281565096995465,30.579267131764482],[108.281850273042465,30.578940406142383],[108.282369595518077,30.578896946453934],[108.28270880885367,30.578623283732405],[108.282871908567003,30.578819475187569],[108.283250164143169,30.578911884319385],[108.283555361532095,30.578759209800943],[108.284310884975881,30.578633032837711],[108.28470416647518,30.578423453929485],[108.285316608788676,30.578387157505315],[108.286365405659183,30.578087352942276],[108.286875803752977,30.57773593263024],[108.287362205228746,30.577709511894557],[108.288391055480858,30.577417751186864],[108.28907665182723,30.577403610898749],[108.289343884809767,30.577522954056935],[108.289435972027107,30.577686088130005],[108.289761261901319,30.577802515417929],[108.289974458744865,30.578162815088152],[108.290243706219258,30.579200257404906],[108.290473928236253,30.57955457987347],[108.291441842901918,30.580050904641649],[108.292558932950286,30.580989487859551],[108.292633012089354,30.581391625880446],[108.293094483433208,30.581918298077628],[108.293092480785745,30.58278537911152],[108.293197587931914,30.58295253268783],[108.293465863093047,30.583125919001176],[108.293997416618311,30.583808726563515],[108.294230659269175,30.583843058582236],[108.294334769048291,30.584013215287033],[108.294534992199303,30.584843572610009],[108.294852332048123,30.585055041167568],[108.295225727344075,30.584992567703978],[108.295621156088444,30.585029146104894],[108.295731282499247,30.585102308796792],[108.295806365276562,30.585283432891625],[108.295704255448399,30.586148364476379],[108.295797360175442,30.586553538666195],[108.295950535722255,30.586844785234216],[108.295945534175246,30.587072804279451],[108.295674232422556,30.587459447193197],[108.295624177725031,30.587727398065102],[108.295821407491118,30.588599766744881],[108.295753335079993,30.588852696586518],[108.295679249147582,30.588891586870648],[108.295532089207938,30.588824374255044],[108.29549804625205,30.588489289314104],[108.295090600316342,30.5880016543842],[108.294921420365711,30.587632379131765],[108.294806295922257,30.58765121645531],[108.294424899730842,30.587938708347355],[108.29437384346744,30.588320672802968],[108.294235704973474,30.588579501219481],[108.294330800395102,30.589159691973386],[108.294466950673254,30.589393908282908],[108.294424909851926,30.589525860543176],[108.293834287296903,30.589729049409325],[108.293187628250877,30.5897891578742],[108.29279223399331,30.589952630998823],[108.292222659837847,30.589848846867472],[108.292099541454277,30.590110704580994],[108.292536981638506,30.590488335719773],[108.292523969217157,30.590565317810103],[108.291927372840078,30.590304492611935],[108.291954404703887,30.590239523259509],[108.291787245392655,30.59017028835758],[108.291582042272864,30.5903320327483],[108.291226704148769,30.590816607519763],[108.291232718324736,30.591050634556719],[108.291524999114159,30.591671079611807],[108.291445921263545,30.591776987561609],[108.29147495081672,30.591935045618737],[108.291946410745226,30.592644741540102],[108.292144602604296,30.592854031808866],[108.292549006599842,30.593062595790688],[108.292806267107665,30.593323978113357],[108.293096559900675,30.593649411183929],[108.293205674225135,30.593983596066565],[108.293626109052227,30.594111182540686],[108.293857343000198,30.594388533318845],[108.294310817898875,30.594722201881076],[108.294382903638734,30.594911323803412],[108.294314827683976,30.595069251083988],[108.293220700868105,30.595652779173122],[108.292987462067188,30.595853483837924],[108.293133620354112,30.597096810512792],[108.293459959263842,30.598182370890683],[108.293290801417186,30.599302248242651],[108.292824330394808,30.600076695045292],[108.292652177240953,30.601993665401498],[108.292839367923904,30.603346065477968],[108.293135675960798,30.604774624529245],[108.293040582244387,30.605175545265158],[108.292813357284004,30.605437254982728],[108.293746314559797,30.606747689194872],[108.294341945548851,30.607305584314059],[108.294569182160117,30.607626944863988],[108.294670297068052,30.607916119446283],[108.295213876636751,30.608138923633188],[108.295357036566671,30.608310142008328],[108.295350024139339,30.608566164050266],[108.296335125213233,30.610042765050022],[108.296315103750146,30.610593796703878],[108.295907656227968,30.611673330230126],[108.294345991205375,30.613209268737993],[108.293296905922986,30.614372950276536],[108.292355970846685,30.615792829111463],[108.291980613600387,30.616667429582446],[108.291614267137803,30.61788908742227],[108.291429088129291,30.61828688894947],[108.291307985346009,30.619408859477026],[108.291231907569212,30.619738805953109],[108.291044739636121,30.620011586503981],[108.289504325059013,30.62090469730401],[108.288618558280376,30.621603666556265],[108.287082282147168,30.622257864371637],[108.286988207114632,30.622338767784953],[108.286955176655937,30.62260275772995],[108.287309471674334,30.62313725204103],[108.287986029667039,30.622668021222786],[108.288819737313375,30.62247402860736],[108.289121002740998,30.622336391018269],[108.289516347293798,30.622014857194035],[108.290726451909336,30.622019421255231],[108.292354012788437,30.621908578374821],[108.293231895617481,30.621717750010085],[108.293279941589205,30.621562801116163],[108.293723392805006,30.621300383061033],[108.294081767081721,30.621286885853802],[108.295189938447763,30.620759391386908],[108.296538426968411,30.620681336050648],[108.296899831755823,30.620589857468172],[108.29716312779685,30.620436224691851],[108.297333321592717,30.620238450426548],[108.298753973836142,30.619650516329241],[108.299130422311094,30.619365050787582],[108.299527899423623,30.61895560977527],[108.299567943661444,30.618825657066985],[108.29946381864923,30.618673478508928],[108.29948683858062,30.618581505647295],[108.300175672600972,30.617576447721071],[108.30038893083433,30.617387755553484],[108.300879541296467,30.61724950985262],[108.301182921159906,30.61707696660276],[108.301334108151167,30.616659150521482],[108.302530630598994,30.616710066177315],[108.30316545933691,30.616549073082425],[108.303490879249821,30.616585604948423],[108.303532936318064,30.616673677640211],[108.303455842173307,30.616901587301125],[108.303202511032467,30.61697318382398],[108.303367725282541,30.617354490947928],[108.303185487109559,30.617471208990189],[108.303201509434757,30.617549246100932],[108.303459852451169,30.617670685934332],[108.303642092880665,30.617567964616612],[108.304291951678678,30.617642035969329],[108.303981544179223,30.617943570074683],[108.30400557245305,30.618050622120307],[108.304734543667308,30.618134830451805],[108.305243237244227,30.617657612141013],[108.305407459951098,30.617776908291095],[108.30620154312777,30.617904251848081],[108.306443888422649,30.618045679090145],[108.306799378660074,30.618529334286716],[108.30708979512049,30.618707849444231],[108.30806816673838,30.618361475325305],[108.308325542342828,30.618401925302578],[108.309453164571664,30.618799930536287],[108.309722558992235,30.618828402467319],[108.30978265121162,30.618859507991971],[108.309847748336381,30.619258672178471],[108.310711015800905,30.619648236259881],[108.311387019006915,30.619611422728269],[108.311551268174313,30.619506705738043],[108.311692482377111,30.619510953476809],[108.312442613370195,30.619980357056939],[108.313570334074811,30.620180407032624],[108.314051073501986,30.620490316877131],[108.314349537690816,30.620953917851441],[108.314104159808082,30.621417530811701],[108.314288459412509,30.622657017443977],[108.314206330320133,30.623062918031511],[108.313730602341408,30.62380215694823],[108.313322987462584,30.624107450997371],[108.312072078368288,30.623879177236869],[108.311468177217762,30.623581071037069],[108.311082602229348,30.623624389286654],[108.310578854284685,30.623849530807735],[108.310443658229289,30.624045318370456],[108.310440648713723,30.624275338005937],[108.310926376314441,30.624401218791739],[108.311085609406533,30.624507508471929],[108.311168737997434,30.624708685648223],[108.311099629111325,30.624846582712262],[108.310693032215099,30.624806852692601],[108.310557826414453,30.624867624402796],[108.310603897620155,30.625097738924023],[108.310369553166296,30.625216333950867],[108.310190293851321,30.625660078990066],[108.31010917685731,30.625978981551352],[108.310417636379043,30.6261415394316],[108.310262409618261,30.626563326932995],[108.310283435468506,30.626665375397142],[108.310418632880115,30.626638607055618],[108.310705058789324,30.626446091381005],[108.312454672445369,30.625805112639959],[108.313159747210406,30.62568036206434],[108.313818756683574,30.625465519740267],[108.314301500938242,30.625472400997438],[108.315012608420744,30.62603776518381],[108.315236961078895,30.626314211831605],[108.315275017301445,30.626638324402812],[108.315522411377586,30.626997827840384],[108.316419829600775,30.627893598286139],[108.31732426851579,30.628710379220102],[108.319028017330538,30.629698678083244],[108.319649034511727,30.630544965286617],[108.320006618102738,30.630952686124481],[108.320147844053722,30.630996965793159],[108.320545494484278,30.630463639117217],[108.320884043195292,30.629721177137363],[108.3210903826985,30.629635564705683],[108.32135181335245,30.629686061928528],[108.321481025658315,30.629850330973696],[108.32187768198898,30.630058106882721],[108.322018923823663,30.630571444851618],[108.322110075184611,30.630667635213573],[108.322814235011194,30.630390936241081],[108.323088688244013,30.630174430014392],[108.323811895825386,30.630070804337667],[108.323849956719584,30.629972864997718],[108.323582509415516,30.629812325447155],[108.323545446156203,30.629703240326947],[108.323601539697719,30.629547330639994],[108.323772827513025,30.62952065133786],[108.324084353245539,30.629650271221202],[108.324241616823045,30.629819587840124],[108.324978857563849,30.630244064647822],[108.325413585450491,30.630312914326712],[108.325857336534753,30.63056980070996],[108.326128798237974,30.630604328931287],[108.326427304113025,30.630322866715947],[108.32661861724462,30.629870170286569],[108.326385220963516,30.629661700974406],[108.326031622701919,30.629529996410596],[108.326005582930179,30.629299921195678],[108.326135796315327,30.629229158205248],[108.32681896015805,30.629287487148272],[108.327107449252722,30.629471071029375],[108.327379912587006,30.629467596845792],[108.327638346934279,30.629744133099884],[108.32795088254278,30.629717726102513],[108.328292466954792,30.6299484220078],[108.328413673208104,30.629731632147145],[108.328940568556149,30.629894673198415],[108.32932022098376,30.629658377818572],[108.329547602659048,30.629641814236919],[108.329833097811246,30.630371473089969],[108.329973335320318,30.630451754038045],[108.330176685901591,30.630412145307538],[108.330653498102478,30.629970010307005],[108.330846834702669,30.630022391117553],[108.33110227349394,30.630396935073691],[108.332214186240961,30.630582125381206],[108.332673974989476,30.630566016669711],[108.332955451290047,30.630260526540859],[108.333069643506633,30.629886698519293],[108.333382179034473,30.629357234454215],[108.333635616915188,30.629336719794644],[108.333906076179929,30.629114223401896],[108.335227337891908,30.628578721472437],[108.335878452294224,30.628083916824515],[108.340461272455997,30.625794470202031],[108.338059160308063,30.623571557850788],[108.335378541550028,30.620721007461647],[108.331787336455562,30.616060455775234],[108.328584816203943,30.61029655028608],[108.328087959752665,30.609212462398787],[108.326024429371472,30.604702968948811],[108.323692464198899,30.599374922403324],[108.323558238924264,30.599068631045746],[108.322300121624963,30.595079819506935],[108.320571243148464,30.590930130361979],[108.319424355930892,30.588891774926704],[108.317173714244092,30.5859032944477],[108.315217608138852,30.582517391109008],[108.314789932179266,30.58092346104004],[108.314030747060031,30.579366949567124],[108.310840874402487,30.57282169916024],[108.310275031121506,30.57198563889806],[108.305329977626315,30.565035645744775],[108.304505851197362,30.563047141839071],[108.303327269406992,30.560702045339422],[108.30096319760834,30.55391783067391],[108.299553452502479,30.550875448712063],[108.298227856023132,30.548016268626434],[108.29794251818582,30.547737824644219]]]";

        System.out.println(evaluate(replace(s)));
    }

    /**
     * 优化后的格式转换
     * @param coordinates
     * @return
     */
    public static String simpleReplace(String coordinates){
        return coordinates.replace(",", " ")
                .replace("] [", ",")
                .replace("[[[", "MULTIPOLYGON(((")
                .replace("]]]", ")))")
                .replace("[", "")
                .replace("]", "")
                ;
    }

    public static String replace(String jwdc){
        return jwdc.replace('[', '(')
                        .replace(']', ')')
                        .replace("))),(((", "));((")
                        .replace("),(", ");(")
                        .replace(",", " ")
                        .replace(";", ",")
                        .replace("(((", "MULTIPOLYGON(((")
                        .replace("((((", "MULTIPOLYGON(((")
                        .replace("MULTIPOLYGONMULTIPOLYGON(((", "MULTIPOLYGON(((")
                        .replace("))))", ")))")
                        .replace("),(", ",")
                        .replace("),(", ",");
    }

    /**
     * 计算区域中心点坐标
     * @param boundPoly
     * @return
     */
    public static String evaluate(String boundPoly) {
        boundPoly=boundPoly.replace("MULTIPOLYGON(((","").replace(")))","").replace(")),((",";");
        String[] boundPolys= boundPoly.split(";");
        ArrayList<String> centers=new ArrayList<>();
        for (String boundPoly1 : boundPolys) {
            double centerLng = 0.0D;
            double centerLat = 0.0D;
            int cnt = 0;
            String[] bounds = boundPoly1.split(",");

            for (String bound : bounds) {
                String[] coors = bound.split(" ");
                centerLng += Double.valueOf(coors[0]);
                centerLat += Double.valueOf(coors[1]);
                cnt += 1;
            }
            centers.add(centerLng / cnt + "," + centerLat / cnt);
        }
        return StringUtils.join(centers,";");
    }
}